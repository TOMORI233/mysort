# README

### Instructions

1. To add `mysort` to your MATLAB path, in MATLAB command line type in

```matlab
>> addpath(genpath(your root path/mysort))
>> savepath
```

2. To sort your single-channel TDT block data

You can first use:

```matlab
sortResult = mysort(data, [], "origin"); % If K is left blank, an optimum K will be used
```

This will sort spike waveforms of your original block data using an optimum K generated by Gap Statistic for K-means.

If you consider some clusters as redundant ones, you can specify a K for this:

```matlab
K = 3; % You can select a K according to PCA raster or K-SSEs / K-gaps curve, 3 for example
sortResult = mysort(data, [], "origin", K);
```

If you are not satisfied with the original spike waveform length, you can specify `waveLength` in `mysort.m` and use:

```matlab
sortResult = mysort(data, [], "origin-reshape");
```

If you want to reselect a threshold for spikes, use:

```matlab
sortResult = mysort(data, [], "reselect");
```

Or use

```matlab
sortResult = mysort(data); % default, same with mysort(data, [], "reselect")
```

This will plot a time-wave curve of at most 100 seconds for preview. When a threshold (in volts) is input in MATLAB command line, the sorting process continues. For multi-channel sorting, `th` is required for every channel.

Still not satisfied? You can specify `CVCRThreshold` (cumulative variance contribution rate threshold, default: 0.9) for PC dimensions selection or convergence condition for K-means in `mKmeans.m` (usually a minimum ratio of relative cluster center shift in Euclidean distance, default: 0.1).

Also you can use MATLAB `pca` and `kmeans` functions instead of `mPCA` and `mKmeans` in `spikeSorting.m`.

3. To sort your multi-channel TDT block data

You can specify channels to sort with the second parameter of `mysort`. Usually `channels` is a vector containing the channel numbers to be sorted one by one. If it is left empty, all channels will be sorted.

```matlab
% data has 32 channels of waves
channels = [1, 2, 14, 20];
sortResult = mysort(data, channels, "reselect"); % sort channel 1,2,14,20 only
sortResult = mysort(data, [], "reselect"); % sort all 32 channels
```

4. A bug in TDT block mat data

By using `TDT2mat` or `TDTbin2mat` , we can import data from TDT block. But it usually contains only one channel of spike data in `snips.eNeu` . **Thus, only `reselect` mode is available for multi-channel sorting at present.**

